<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的健康中台</title>
    <!-- 引入 Tailwind CSS 进行样式设计 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入 FontAwesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; }
        .tab-active { color: #10b981; border-bottom: 2px solid #10b981; }
        .tab-inactive { color: #9ca3af; }
        /* 隐藏滚动条但允许滚动 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

<div id="app" class="flex flex-col h-full max-w-md mx-auto bg-white shadow-2xl relative">

    <!-- 顶部 Header -->
    <header class="bg-emerald-600 text-white p-4 pt-8 pb-12 rounded-b-3xl shadow-md z-10 shrink-0">
        <div class="flex justify-between items-center mb-2">
            <h1 class="text-xl font-bold"><i class="fas fa-heartbeat mr-2"></i>健康日志</h1>
            <span class="text-xs bg-emerald-700 px-2 py-1 rounded">{{ currentDate }}</span>
        </div>
        <div class="flex justify-between items-end">
            <div>
                <p class="text-emerald-100 text-sm">今日状态</p>
                <p class="text-2xl font-bold">{{ completionRate }}% <span class="text-xs font-normal">补剂完成度</span></p>
            </div>
            <div class="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                <i class="fas fa-user-md text-2xl"></i>
            </div>
        </div>
    </header>

    <!-- 主体内容区域 (可滚动) -->
    <main class="flex-1 overflow-y-auto no-scrollbar -mt-8 px-4 pb-20 z-20">
        
        <!-- 视图 1: 日常补剂 (Daily) -->
        <div v-if="currentTab === 'daily'" class="space-y-4">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                <h2 class="text-gray-800 font-bold mb-3 flex items-center">
                    <i class="fas fa-pills text-emerald-500 mr-2"></i> 今日补剂
                </h2>
                <div v-for="(item, index) in supplements" :key="index" 
                     @click="toggleSupplement(index)"
                     class="flex items-center justify-between p-3 mb-2 rounded-lg border transition-all cursor-pointer"
                     :class="item.done ? 'bg-emerald-50 border-emerald-200' : 'bg-gray-50 border-gray-100'">
                    <div class="flex items-center">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-3"
                             :class="item.done ? 'bg-emerald-500 border-emerald-500' : 'border-gray-300'">
                            <i v-if="item.done" class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-medium" :class="{'text-gray-400 line-through': item.done}">{{ item.name }}</p>
                            <p class="text-xs text-gray-500">{{ item.desc }}</p>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">{{ item.time }}</span>
                </div>
                <button @click="resetDaily" class="w-full mt-2 text-xs text-gray-400 hover:text-emerald-600 text-center py-2">
                    <i class="fas fa-redo"></i> 重置今日打卡
                </button>
            </div>
        </div>

        <!-- 视图 2: 突发用药 (Meds Log) -->
        <div v-if="currentTab === 'meds'" class="space-y-4">
            <!-- 输入框 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                <h2 class="text-gray-800 font-bold mb-3"><i class="fas fa-capsules text-orange-500 mr-2"></i> 临时用药记录</h2>
                <div class="space-y-3">
                    <input v-model="newMed.name" type="text" placeholder="药物名称 (如: 布洛芬)" class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-orange-200 text-sm">
                    <input v-model="newMed.reason" type="text" placeholder="症状/原因 (如: 头痛)" class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-orange-200 text-sm">
                    <button @click="addMedRecord" :disabled="!newMed.name" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-medium transition shadow-lg shadow-orange-200 disabled:opacity-50">
                        记录用药
                    </button>
                </div>
            </div>

            <!-- 历史列表 -->
            <div class="space-y-2">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">最近记录</h3>
                <div v-if="medHistory.length === 0" class="text-center py-8 text-gray-400 text-sm">
                    暂无用药记录，身体很棒哦！
                </div>
                <div v-for="(log, index) in medHistory" :key="index" class="bg-white p-3 rounded-lg shadow-sm border-l-4 border-orange-400 flex justify-between items-start">
                    <div>
                        <p class="font-bold text-gray-800">{{ log.name }}</p>
                        <p class="text-xs text-gray-500 bg-gray-100 inline-block px-1.5 py-0.5 rounded mt-1">{{ log.reason }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-400">{{ formatTime(log.timestamp) }}</p>
                        <p class="text-xs text-gray-300 mt-1">{{ formatDate(log.timestamp) }}</p>
                        <button @click="deleteMed(index)" class="text-xs text-red-300 mt-1 hover:text-red-500">删除</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图 3: 检查计划 (Plans) -->
        <div v-if="currentTab === 'plans'" class="space-y-4">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                <h2 class="text-gray-800 font-bold mb-4"><i class="fas fa-calendar-check text-blue-500 mr-2"></i> 健康日程表</h2>
                
                <div class="relative border-l-2 border-gray-200 ml-3 space-y-6 pb-2">
                    <!-- 循环渲染检查计划 -->
                    <div v-for="(plan, index) in healthPlans" :key="index" class="relative pl-6">
                        <!-- 时间轴点 -->
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 border-white shadow-sm"
                             :class="getPlanColor(plan.type)"></div>
                        
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-xs font-bold text-white px-2 py-0.5 rounded-full mb-1 inline-block"
                                      :class="plan.type === 'annual' ? 'bg-blue-500' : 'bg-indigo-400'">
                                    {{ plan.type === 'annual' ? '年度大检' : '季度检查' }}
                                </span>
                                <h3 class="font-bold text-gray-800">{{ plan.name }}</h3>
                                <p class="text-xs text-gray-500 mt-1">计划日期: {{ plan.dueDate }}</p>
                            </div>
                            <div class="text-right">
                                <button @click="togglePlanStatus(index)" 
                                        class="text-xs px-3 py-1 rounded border transition"
                                        :class="plan.status === 'done' ? 'bg-green-100 text-green-700 border-green-200' : 'bg-white text-gray-500 border-gray-200'">
                                    {{ plan.status === 'done' ? '已完成' : '待检查' }}
                                </button>
                            </div>
                        </div>
                        <!-- 如果有文件上传需求的模拟UI -->
                        <div v-if="plan.status === 'done'" class="mt-2 bg-gray-50 p-2 rounded text-xs text-gray-400 flex items-center">
                            <i class="fas fa-file-pdf mr-2"></i> 报告已归档 (模拟)
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                <h4 class="text-blue-800 font-bold text-sm mb-1">健康贴士</h4>
                <p class="text-xs text-blue-600">距离下一次季度检查还有 24 天，请记得提前空腹。</p>
            </div>
        </div>

    </main>

    <!-- 底部导航栏 -->
    <nav class="bg-white border-t border-gray-100 shrink-0 pb-safe">
        <div class="flex justify-around items-center h-16">
            <button @click="currentTab = 'daily'" class="flex flex-col items-center w-1/3 py-2 transition" :class="currentTab === 'daily' ? 'text-emerald-600' : 'text-gray-400'">
                <i class="fas fa-sun text-xl mb-1"></i>
                <span class="text-xs scale-90">今日补剂</span>
            </button>
            <button @click="currentTab = 'meds'" class="flex flex-col items-center w-1/3 py-2 transition" :class="currentTab === 'meds' ? 'text-orange-500' : 'text-gray-400'">
                <i class="fas fa-first-aid text-xl mb-1"></i>
                <span class="text-xs scale-90">用药记录</span>
            </button>
            <button @click="currentTab = 'plans'" class="flex flex-col items-center w-1/3 py-2 transition" :class="currentTab === 'plans' ? 'text-blue-500' : 'text-gray-400'">
                <i class="fas fa-clipboard-list text-xl mb-1"></i>
                <span class="text-xs scale-90">定期检查</span>
            </button>
        </div>
    </nav>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentTab: 'daily',
                currentDate: new Date().toLocaleDateString('zh-CN', {month:'long', day:'numeric', weekday:'short'}),
                
                // 1. 补剂数据
                supplements: [
                    { name: '综合维生素', desc: '饭后服用', time: '早晨', done: false },
                    { name: '鱼油 (Omega-3)', desc: '随餐服用', time: '午餐', done: false },
                    { name: '镁片', desc: '助眠', time: '睡前', done: false }
                ],
                
                // 2. 用药记录数据
                newMed: { name: '', reason: '' },
                medHistory: [],
                
                // 3. 检查计划数据
                healthPlans: [
                    { name: '全身深度体检', type: 'annual', dueDate: '2025-10-15', status: 'pending' },
                    { name: '牙齿检查 & 洗牙', type: 'quarterly', dueDate: '2025-06-01', status: 'pending' },
                    { name: '肝肾功能复查', type: 'quarterly', dueDate: '2025-03-01', status: 'done' } // 模拟已完成
                ]
            }
        },
        computed: {
            completionRate() {
                if (this.supplements.length === 0) return 0;
                const doneCount = this.supplements.filter(s => s.done).length;
                return Math.round((doneCount / this.supplements.length) * 100);
            }
        },
        mounted() {
            this.loadData();
        },
        methods: {
            // 切换补剂状态
            toggleSupplement(index) {
                this.supplements[index].done = !this.supplements[index].done;
                this.saveData();
            },
            resetDaily() {
                this.supplements.forEach(s => s.done = false);
                this.saveData();
            },
            
            // 添加用药记录
            addMedRecord() {
                if (!this.newMed.name) return;
                this.medHistory.unshift({
                    name: this.newMed.name,
                    reason: this.newMed.reason || '无备注',
                    timestamp: new Date().getTime()
                });
                this.newMed.name = '';
                this.newMed.reason = '';
                this.saveData();
            },
            deleteMed(index) {
                if(confirm('确定删除这条记录吗？')) {
                    this.medHistory.splice(index, 1);
                    this.saveData();
                }
            },
            
            // 切换检查计划状态
            togglePlanStatus(index) {
                const plan = this.healthPlans[index];
                plan.status = plan.status === 'done' ? 'pending' : 'done';
                this.saveData();
            },
            getPlanColor(type) {
                return type === 'annual' ? 'bg-blue-500' : 'bg-indigo-400';
            },

            // 工具函数：时间格式化
            formatTime(timestamp) {
                return new Date(timestamp).toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            },
            formatDate(timestamp) {
                return new Date(timestamp).toLocaleDateString('zh-CN', {month:'short', day:'numeric'});
            },

            // 本地存储逻辑
            saveData() {
                localStorage.setItem('myHealth_supplements', JSON.stringify(this.supplements));
                localStorage.setItem('myHealth_medHistory', JSON.stringify(this.medHistory));
                localStorage.setItem('myHealth_plans', JSON.stringify(this.healthPlans));
            },
            loadData() {
                const savedSupplements = localStorage.getItem('myHealth_supplements');
                const savedMeds = localStorage.getItem('myHealth_medHistory');
                const savedPlans = localStorage.getItem('myHealth_plans');

                if (savedSupplements) this.supplements = JSON.parse(savedSupplements);
                if (savedMeds) this.medHistory = JSON.parse(savedMeds);
                if (savedPlans) this.healthPlans = JSON.parse(savedPlans);
            }
        }
    }).mount('#app');
</script>

</body>
</html>